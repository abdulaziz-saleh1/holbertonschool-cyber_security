#!/bin/bash
whois $1 | awk 'BEGIN{n=split("Name|Organization|Street|City|State/Province|Postal Code|Country|Phone|Phone Ext|Fax|Fax Ext|Email",K,"|");S[1]="Registrant";S[2]="Admin";S[3]="Tech"}{if($0!~/^(Registrant|Admin|Tech) /)next;split($0,a,":");left=a[1];sec=left;sub(/ .*/,"",sec);key=left;sub(/^[^ ]+ /,"",key);val=$0;sub(/^[^:]*:[ ]*/,"",val);sub(/\r$/,"",val);if(key=="Street"&&V[sec,key]!="")V[sec,key]=V[sec,key]" "val;else V[sec,key]=val}END{for(s=1;s<=3;s++){sec=S[s];for(i=1;i<=n;i++){key=K[i];val=V[sec,key];field=sec" "key;if(key=="Street")val=val" ";if(key=="Phone Ext")field=sec" Phone Ext:";if(key=="Fax Ext")field=sec" Fax Ext:";print field","val}}}' > $1.csv
